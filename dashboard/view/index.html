<!DOCTYPE html>
<html>

<head>
	<!-- Required meta tags -->
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>USA 2024 election prediction</title>
	<!--Chart.js JS CDN-->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.js"
		integrity="sha512-ZwR1/gSZM3ai6vCdI+LVF1zSq/5HznD3ZSTk7kajkaj4D292NLuduDCO1c/NT8Id+jE58KYLKT7hXnbtryGmMg=="
		crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</head>

<body>
	<canvas id="myChart"></canvas>
	<script type="text/javascript">
		var ctx = document.getElementById('myChart').getContext('2d');
		var myChart = new Chart(ctx, {
			type: 'line',
			data: {
				labels: [],
				datasets: [
					{
						data: [],
						label: "Trump",
						borderColor: "rgba(255, 99, 132)",
						backgroundColor: "rgba(255, 99, 132)",
						fill: 'start',
						pointStyle: false
					}, {
						data: [],
						label: "Harris",
						borderColor: "rgba(54, 162, 235)",
						backgroundColor: "rgba(54, 162, 235)",
						fill: 'start',
						pointStyle: false
					}
				]
			},
			options: {
				responsive: true,
				plugins: {
					title: {
						display: true,
						text: (ctx) => 'Chart.js Line Chart - stacked=' + ctx.chart.options.scales.y.stacked
					},
					tooltip: {
						mode: 'index'
					},
				},
				interaction: {
					mode: 'nearest',
					axis: 'x',
					intersect: false
				},
				scales: {
					x: {
						title: {
							display: true,
							text: 'Timestamp'
						}
					},
					y: {
						max: 100,
						stacked: true,
						title: {
							display: true,
							text: 'Predicted popularity (%)'
						}
					}
				}
			}
		});


		function updateChart() {

			// Parsing attributes from the script tag
			fetch('/chart-data')
				.then(response => response.json())
				.then(data => {
					data = JSON.parse(data)
					// Update Chart.js data
					myChart.data.labels = data.timestamps;
					myChart.data.datasets[0].data = data.trumpPopularity;
					myChart.data.datasets[1].data = data.harrisPopularity;
					myChart.update();
				});


		}
		updateChart()
		setInterval(function () {
			updateChart()
			console.log("update")
		}, 1000);

	</script>
</body>

</html>
